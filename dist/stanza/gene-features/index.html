<script src="../assets/components/jquery/dist/jquery.min.js"></script>
<script src="../assets/components/handlebars/handlebars.min.js"></script>
<script>
(function(descriptor) {
  function Stanza(execute) {
  var proto = Object.create(HTMLElement.prototype);

  function createStanzaHelper(element) {
    return {
      query: function(params) {
        var queryTemplate = Handlebars.compile(descriptor.templates[params.template], {noEscape: true});
        var query = queryTemplate(params.parameters);

        return $.ajax({
          url: params.endpoint,
          data: {
            format: "json",
            query: query
          }
        });
      },
      render: function(params) {
        var htmlTemplate = Handlebars.compile(descriptor.templates[params.template]);
        var htmlFragment = htmlTemplate(params.parameters);
        var selector = params.selector || "main";
        $(selector, element.shadowRoot).html(htmlFragment);
      },
      root: element.shadowRoot,
      select: function(selector) {
        return this.root.querySelector(selector);
      },
      selectAll: function(selector) {
        return this.root.querySelectorAll(selector);
      }
    };
  }

  function update(element) {
    var params = {};
    descriptor.parameters.forEach(function(key) {
      params[key] = element.getAttribute(key);
    });
    execute(createStanzaHelper(element), params);
  }

  proto.createdCallback = function() {
    var shadow = this.createShadowRoot();

    var style = document.createElement("style");
    style.appendChild(document.createTextNode(descriptor.stylesheet));
    shadow.appendChild(style);
    var main = document.createElement("main");
    shadow.appendChild(main);

    update(this);
  };

  proto.attributeChangedCallback = function(attrName, oldVal, newVal) {
    update(this);
  };

  document.registerElement(descriptor.elementName, {
    prototype: proto
  });
};

  Stanza(function(stanza, params) {
  var q = stanza.query({
    endpoint: "http://dev.togogenome.org/sparql-test",
    template: "stanza.rq",
    parameters: params
  });

  q.then(function(data) {
    var rows = data.results.bindings;
    stanza.render({
      template: "stanza.html",
      parameters: {
        features: rows
      },
    });
  });
});

})({"templates":{"stanza.html":"{{#each features}}\n\u003cdl\u003e\n  \u003cdt\u003eFeature Product\u003c/dt\u003e\u003cdd\u003e{{feature_product.value}}\u003c/dd\u003e\n  \u003cdt\u003eFeature Gene\u003c/dt\u003e\u003cdd\u003e{{feature_gene.value}}\u003c/dd\u003e\n  \u003cdt\u003eFeature Gene Synonym\u003c/dt\u003e\u003cdd\u003e{{feature_gene_synonym.value}}\u003c/dd\u003e\n\u003c/dl\u003e\n{{/each}}\n","stanza.rq":"PREFIX rdfs: \u003chttp://www.w3.org/2000/01/rdf-schema#\u003e\nPREFIX insdc: \u003chttp://ddbj.nig.ac.jp/ontologies/nucleotide/\u003e\nSELECT DISTINCT ?feature_product ?feature_gene ?feature_gene_synonym\nWHERE {\n  ?s rdfs:label \"{{gene_id}}\" .\n  ?s insdc:product ?feature_product .\n\n  OPTIONAL {\n    ?s insdc:gene  ?feature_gene .\n    ?s insdc:gene_synonym  ?feature_gene_synonym .\n  }\n}\n"},"parameters":["gene_id"],"elementName":"togostanza-gene-features","stylesheet":"@charset \"UTF-8\";\n\n* {\n\tbackground-color: transparent;\n\tpadding: 1px 2px 3px;\n\tfont-family: \"Myriad Pro\",\"Helvetica Neue\",san-serif;\n\tfont-size: 16px;\n\tline-height: 20px;\n}\na {\n\tcolor:#45b8cc;\n}\n\nul, ol {\n\tpadding:0;\n\tmargin:0 0 0 16px;\n}\ndl {\n\tmargin: 0;\n\tpadding: 0;\n}\ndd {\n\tmargin: 0;\n}\ndt + dt, dd + dt,\ndt + dd, dd + dd {\n\tmargin-top: 8px;\n}\n\n\nmain {\n\t-webkit-border-radius: 4px;\n\t-moz-border-radius: 4px;\n\tborder-radius: 4px;\n\t-webkit-box-shadow: 0 2px 2px rgba(0,0,0,.2);\n\t-moz-box-shadow: 0 2px 2px rgba(0,0,0,.2);\n\tbox-shadow: 0 2px 2px rgba(0,0,0,.2);\n\tbackground-color: #fff;\n}\n.table + .table, .table + div,\ndiv + .table, div + div {\n\tmargin-top: 5px;\n}\n\ndiv {\n\tpadding: 10px 20px;\n}\n\n.table {\n\tborder-style: solid;\n\tborder-color: #fff;\n\tborder-top-width: 5px;\n\tborder-bottom-width: 5px;\n\tborder-left-width: 20px;\n\tborder-right-width: 20px;\n}\n.table {\n\tmargin-bottom: 0;\n\tword-break:break-all;\n}\n.table caption {\n\tbackground-color: #8ac8d1;\n\ttext-align: left;\n\tcolor: white;\n\tfont-size: 18px;\n\tline-height: 22px;\n\theight: 22px;\n\tfont-weight: bold;\n\tpadding: 10px 24px 4px;\n\tmargin: 0;\n\tborder-top-left-radius: 4px;\n\tborder-top-right-radius: 4px;\n}\n.table thead th, .table thead td {\n\tborder-bottom: 1px solid #555;\n}\n.table th, .table td,\n.table \u003e tth, .table \u003e ttd {\n\tpadding: 10px 4px;\n\tline-height: 20px;\n\ttext-align: left;\n\tvertical-align: top;\n\tborder-top: 1px solid #9fadad;\n}\n.table \u003e tr:first-child \u003e th, .table \u003e tr:first-child \u003e td,\n.table \u003e ttr:first-child \u003e th, .table \u003e ttr:first-child \u003e td {\n\tborder-top: none;\n}\nth \u003e .table, td \u003e .table {\n\tmargin: -10px -4px;\n\twidth: 100%;\n}\n.table li + li {\n\tmargin-top: 4px;\n}\ntd.numeric {\n  text-align: right;\n}\nth.nowrap,\ntd.nowrap {\n  white-space: nowrap;\n}\n\npre {\n\tbackground-color:#daf1f5;\n\tborder:1px solid #ccc;\n\tborder:1px solid rgba(0,0,0,0.15);\n\tpadding: 8px 16px;\n}\n\n/* grid */\n.span1, .span2, .span3, .span4, .span5, .span6, .span7, .span8, .span9, .span10, .span11, .span12 {\n\t-moz-box-sizing: border-box;\n\tbox-sizing: border-box;\n}\n.span1 { width: 8.3333%; }\n.span2 { width: 16.6666%; }\n.span3 { width: 25%; }\n.span4 { width: 33.3333%; }\n.span5 { width: 41.6666%; }\n.span6 { width: 50%; }\n.span7 { width: 58.3333%; }\n.span8 { width: 66.6666%; }\n.span9 { width: 75%; }\n.span10 { width: 83.3333%; }\n.span11 { width: 91.6666%; }\n.span12 { width: 100%; }\n\ndiv#stanza_buttons {\n\tmargin: 0 0;\n\tpadding: 0 0;\n}\n\n/* tool bar */\n/* line 134, ../sass/stanza.scss */\n#tool_bar {\n  margin-top: 0;\n  border-top-left-radius: 0;\n  border-top-right-radius: 0;\n  font-size: 12px;\n  line-height: 30px;\n  color: #999;\n  background-color: #fff;\n  padding-top: 2px;\n  border-top: dashed 1px #ccc;\n  /*@include box-shadow(0 1px 2px rgba(0, 0, 0, 0.2), inset 0 10px 8px -8px rgba(0, 0, 0, 0.12));*/\n  z-index: 1000;\n  position: relative;\n}\n/* line 145, ../sass/stanza.scss */\n#tool_bar a {\n  color: #45b8cc;\n  margin-right: 1.5em;\n}\n/* line 148, ../sass/stanza.scss */\n#tool_bar a:hover {\n  color: #005580;\n}\n/* line 152, ../sass/stanza.scss */\n#tool_bar p {\n  margin-bottom: 0;\n}\n/* line 155, ../sass/stanza.scss */\n#tool_bar:before, #tool_bar:after {\n  display: table;\n  line-height: 0;\n  content: \"\";\n}\n/* line 160, ../sass/stanza.scss */\n#tool_bar:after {\n  clear: both;\n}\n"});
</script>
